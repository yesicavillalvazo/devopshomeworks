# This is an example webapp.io configuration for Angular
FROM vm/ubuntu:18.04

# Layerfiles create entire VMs, not containers!

# Remove existing Node.js and npm (if you want to clean up before installing a new version)
# This step is optional and can be skipped if you are okay with overriding the existing version
RUN apt-get remove -y nodejs npm

# Install the latest Node.js version
RUN curl -sL https://deb.nodesource.com/setup_current.x | bash - && \
    apt-get install --no-install-recommends -y gcc g++ make nodejs && \
    rm -rf /var/lib/apt/lists/* && \
    rm -f /etc/apt/sources.list.d/nodesource.list

# Install Angular CLI
RUN npm install -g @angular/cli

COPY . .
RUN npm install
RUN ng build --optimization=false

# Small hack - node doesn't persist in destination of a COPY
RUN BACKGROUND ng serve --host 0.0.0.0 --disable-host-check
EXPOSE WEBSITE http://localhost:4200
